# 내 기록 내보내기 (CSV/XLSX) 구현안

## 배경/정의
- “백업”이 아니라 **사용자가 자신의 타임라인을 CSV/엑셀로 소유**하는 기능.
- 복원(Import)은 MVP 범위에서 제외.

---

## 목표
1) 내 기록을 CSV 또는 XLSX로 내려받을 수 있게 한다.
2) 엑셀에서 바로 열렸을 때 깨지지 않는 형식으로 제공한다.
3) 레트로/기본 모드와 무관하게 **설정 화면에서 접근**한다.

---

## 범위
### 포함
- 모든 기록(영상/책) 타임라인 내보내기
- 선택 옵션: 기간, 상태, 콘텐츠 타입(영상/책/전체)
- 파일 형식: CSV(기본) + XLSX(선택)

### 제외
- 복원(Import)
- 서버 동기화/서버 백업과의 연결
- 파일 암호화

---

## UX 제안
### 위치
- `설정` 화면에 섹션 추가: “내 기록 내보내기”
- `나의 타임라인` 상단에 CSV 다운로드 아이콘 추가

### 플로우
1) 설정 > 내 기록 내보내기
2) 기간/필터 선택
3) `CSV 다운로드` / `엑셀(XLSX) 다운로드`

---

## 데이터 원천
### 1안: 로컬(IndexedDB/Dexie) 기반
- 장점: 구현 간단, 서버 의존 없음
- 단점: **로컬에 없는 데이터**는 누락 가능

### 2안: 서버 기반 (보완)
- `/api/logs` 페이지네이션 or 전용 export API 추가
- 장점: 완전한 기록 보장
- 단점: 백엔드 작업 필요

**MVP 권장:** 1안(로컬 기반)으로 먼저 제공하고, “최신 동기화 후 내보내기” 안내 문구 추가.

---

## CSV/XLSX 컬럼 정의(제안)
### 공통
- `watchedAt` (YYYY-MM-DD)
- `title`
- `type` (표기값: 영화/시리즈/책)
- `status` (표기값: 봤어요/보는 중/보고 싶어요, 책은 읽었어요/읽는 중/읽고 싶어요)
- `rating` (숫자)
- `note`
- `place` (표기값)
- `occasion` (표기값)
- `ott_or_platform`

### 컨텐츠 메타
- 시즌/에피소드/연도/저자/출판사/ISBN/출판일 등 메타 컬럼은 제외

---

## 파일 포맷 세부
### CSV
- UTF-8 with BOM(엑셀 한글 깨짐 방지)
- 쉼표/줄바꿈 포함 필드는 RFC 4180 방식으로 이스케이프

### XLSX
- SheetJS(`xlsx`) 사용
- 워크시트 이름: `timeline`

---

## 구현 단계 (프론트)
1) `lib/export.ts` 신설
   - `buildExportRows(logs: WatchLog[])`
   - `downloadCsv(rows)`
   - `downloadXlsx(rows)`
2) `localStore`에서 전체 로그 로딩
   - `db.logs.toArray()` + `deletedAt` 필터
3) 설정 화면(`apps/web/app/account/page.tsx`)에 UI 추가
4) 필터 UI(기간/상태/콘텐츠 타입) 적용

---

## 오픈 이슈
- 로컬 DB에 없는 기록이 있을 수 있음 → “동기화 후 내보내기” 안내 필요
- XLSX 의존성 추가 여부(번들 사이즈) → CSV만 먼저 제공할지 결정 필요
- 날짜 포맷(로컬 타임존 vs ISO) 확정

---

## 최소 구현(MVP)
- CSV 다운로드만 제공
- 로컬 데이터 전체 내보내기
- 설정 화면에 단일 버튼만 제공
